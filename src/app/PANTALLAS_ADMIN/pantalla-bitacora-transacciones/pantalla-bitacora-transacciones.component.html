<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bitácora de Transacciones</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f9fa;
    }
    .header {
      text-align: center;
      margin: 20px 0 30px;
    }
    .main-title {
      font-size: 32px;
      font-weight: bold;
      color: #333;
      margin-top: 10px;
    }
    
    .card {
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .card-header {
      background-color: #1a4679;
      color: white;
      padding: 10px 15px;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
    }
    .table {
      margin-bottom: 0;
    }
    .table th {
      background-color: #1a4679;
      color: white;
      font-weight: 500;
    }
    .table-hover tbody tr:hover {
      background-color: #f1f5f9;
    }
    .texto-comprimido {
      max-width: 150px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1050;
    }
    .modal-content {
      max-width: 800px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    }
    .modal-header {
      background-color: #f8f9fa;
      border-bottom: 1px solid #dee2e6;
      padding: 15px 20px;
      position: relative; /* Para posicionar el título y logo correctamente */
    }
    .modal-logo {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      height: 40px;
    }
    
    .modal-title {
      text-align: center;
      width: 100%;
      margin: 0;
      font-weight: 600;
    }
    .modal-body {
      padding: 20px;
    }
    .section-title {
      color: #1a4679;
      border-bottom: 1px solid #dee2e6;
      padding-bottom: 8px;
      margin-bottom: 15px;
      font-weight: 600;
    }
    .modal-footer {
      padding: 12px 20px;
      border-top: 1px solid #dee2e6;
    }
    .form-control, .form-select {
      border-radius: 6px;
    }
    .btn-secondary {
      background-color: #000000;
      border-color: #2f3030;
    }
    .btn-info {
      background-color: #1a4679;
      border-color: #1a4679;
      color: white;
      padding: 6px 12px; /* Más espacio dentro del botón */
      min-width: 80px; /* Ancho mínimo para el botón */
    }
    .btn-info:hover {
      background-color: #15365e;
      border-color: #15365e;
      color: white;
    }
    .search-container {
      margin-bottom: 20px;
    }
    .modal-table th {
      width: 40%;
      background-color: #f8f9fa;
      color: #333;
    }
    .modal-table td {
      width: 60%;
    }
    .modal-table tr {
      border-bottom: 1px solid #eee;
    }
    /* Estilos para el logo en el modal */
    .logo-container-modal {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      align-items: center;
    }
    /* Para dar más espacio en la tabla a la columna de acción */
    .col-accion {
      width: 100px; /* Ancho fijo para la columna de acción */
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Logo y título centrados como en la imagen -->
    <div class="logo-container">
      <div class="logo">
          <div class="logo-box">
              <span>M</span>
          </div>
      </div>
      <div class="brand-name">MOVICASH</div>
      <h1 class="title">BITACORA DE TRANSACCIONES</h1> <!-- Título debajo del logotipo -->
    </div>
    

    <!-- Barra de búsqueda ANTES del panel de filtros -->
    <div class="search-container">
      <div class="input-group">
        <input type="text" class="form-control" placeholder="Buscar transacción..." aria-label="Buscar transacción">
      </div>
    </div>

    <!-- Panel de filtros -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">Filtros</h5>
      </div>
      <div class="card-body">
        <form [formGroup]="filterForm">
          <div class="row g-2">
            <div class="col-md-2 mb-2">
              <label for="id" class="form-label">ID Comprobante</label>
              <input type="text" class="form-control" id="id" formControlName="id" placeholder="ID">
            </div>
            <div class="col-md-2 mb-2">
              <label for="estado" class="form-label">Estado</label>
              <select class="form-select" id="estado" formControlName="estado">
                <option *ngFor="let estado of estados" [value]="estado">{{ estado }}</option>
              </select>
            </div>
            <div class="col-md-2 mb-2">
              <label for="fechaInicio" class="form-label">Fecha inicio</label>
              <input type="date" class="form-control" id="fechaInicio" formControlName="fechaInicio">
            </div>
            <div class="col-md-2 mb-2">
              <label for="fechaFin" class="form-label">Fecha fin</label>
              <input type="date" class="form-control" id="fechaFin" formControlName="fechaFin">
            </div>
            <div class="col-md-4 d-flex align-items-end mb-2">
              <button type="button" class="btn btn-secondary me-2" (click)="limpiarFiltros()">
                <i class="bi bi-eraser"></i> Limpiar
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- Tabla de transacciones con estilo similar a la imagen -->
    <div class="card">
      <div class="table-responsive">
        <!-- Loader -->
        <div *ngIf="isLoading" class="text-center py-3">
          <div class="spinner-border" role="status">
            <span class="visually-hidden">Cargando...</span>
          </div>
          <p class="mt-2">Cargando transacciones...</p>
        </div>

        <!-- Mensaje de error -->
        <div *ngIf="!isLoading && errorMessage" class="alert alert-danger m-3 py-2">
          {{ errorMessage }}
        </div>

        <!-- Mensaje sin resultados -->
        <div *ngIf="!isLoading && !errorMessage && transaccionesFiltradas.length === 0" class="alert alert-info m-3 py-2">
          No se encontraron transacciones con los filtros aplicados.
        </div>

        <!-- Tabla de resultados con estilo similar a la imagen -->
        <table *ngIf="!isLoading && !errorMessage && transaccionesFiltradas.length > 0" class="table table-bordered table-hover">
          <thead>
            <tr>
              <th>IdComprobante</th>
              <th>ClaveRastreo</th>
              <th>Fecha</th>
              <th>Tipo</th>
              <th>Concepto</th>
              <th>Monto</th>
              <th>Estado</th>
              <th>Beneficiario</th>
              <th>Cuenta Ben.</th>
              <th class="col-accion">Acción</th> <!-- Clase añadida para controlar el ancho -->
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let transaccion of transaccionesFiltradas">
              <td class="texto-comprimido" title="{{ transaccion.IdComprobante }}">{{ transaccion.IdComprobante || 'N/A' }}</td>
              <td class="texto-comprimido" title="{{ transaccion.ClaveRastreo }}">{{ transaccion.ClaveRastreo || 'N/A' }}</td>
              <td>{{ transaccion.Fecha | date:'dd/MM/yy HH:mm' }}</td>
              <td>{{ transaccion.Tipo || 'N/A' }}</td>
              <td class="texto-comprimido" title="{{ transaccion.Concepto }}">{{ transaccion.Concepto || 'N/A' }}</td>
              <td [ngClass]="{'text-success': transaccion.Monto > 0, 'text-danger': transaccion.Monto < 0}">
                {{ isValidMonto(transaccion.Monto) }}
              </td>
              <td>
                <span class="badge" [ngClass]="{
                  'bg-warning': transaccion.Estado === 'Pendiente',
                  'bg-success': transaccion.Estado === 'Aprobado',
                  'bg-danger': transaccion.Estado === 'Cancelado'
                }">{{ transaccion.Estado }}</span>
              </td>
              <td class="texto-comprimido" title="{{ transaccion.NombreCompletoBeneficiario }}">{{ transaccion.NombreCompletoBeneficiario || 'N/A' }}</td>
              <td class="texto-comprimido" title="{{ transaccion.NumeroCuentaBeneficiario }}">{{ transaccion.NumeroCuentaBeneficiario || 'N/A' }}</td>
              <td class="text-center col-accion">
                <button class="btn btn-info btn-sm" (click)="abrirDetalleTransaccion(transaccion)">Más info</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Modal para mostrar detalles completos de transacción (mejorado) -->
    <div *ngIf="isModalOpen" class="modal-overlay" tabindex="-1" aria-labelledby="detalleTransaccionModalLabel" aria-hidden="true" (click)="cerrarModal()">
      <div class="modal-content modal-form" (click)="$event.stopPropagation()">
        <div class="modal-content">
          <div class="modal-header">
            <!-- Logo en la esquina izquierda -->
            <div class="logo-container-modal">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 180 40" width="160" height="40">
                <rect x="2" y="7" width="26" height="26" fill="none" stroke="#333" stroke-width="2"/>
                <rect x="5" y="10" width="20" height="20" fill="none" stroke="#333" stroke-width="1"/>
                <text x="15" y="25" font-family="Arial, sans-serif" font-weight="500" font-size="14" fill="#333" text-anchor="middle">M</text>
                <text x="35" y="25" font-family="Arial, sans-serif" font-weight="normal" font-size="18" fill="#999">MOVICASH</text>
              </svg>
            </div>
            
            <!-- Título centrado -->
            <h5 class="modal-title" id="detalleTransaccionModalLabel">Detalle de transacción</h5>
            
            <!-- Espacio en la derecha para mantener el título centrado -->
            <div style="width: 15px;"></div>
          </div>
          <div class="modal-body" *ngIf="transaccionSeleccionada">
            <!-- Detalles de la transacción mejorados -->
            <div class="row">
              <div class="col-md-6">
                <h6 class="section-title">Información básica</h6>
                <table class="table table-sm modal-table">
                  <tbody>
                    <tr>
                      <th>ID Comprobante:</th>
                      <td>{{ transaccionSeleccionada.IdComprobante || 'N/A' }}</td>
                    </tr>
                    <tr>
                      <th>Clave Rastreo:</th>
                      <td>{{ transaccionSeleccionada.ClaveRastreo || 'N/A' }}</td>
                    </tr>
                    <tr>
                      <th>Fecha:</th>
                      <td>{{ transaccionSeleccionada.Fecha | date:'dd/MM/yyyy HH:mm:ss' }}</td>
                    </tr>
                    <tr>
                      <th>Tipo:</th>
                      <td>{{ transaccionSeleccionada.Tipo || 'N/A' }}</td>
                    </tr>
                    <tr>
                      <th>Concepto:</th>
                      <td>{{ transaccionSeleccionada.Concepto || 'N/A' }}</td>
                    </tr>
                    <tr>
                      <th>Monto:</th>
                      <td [ngClass]="{'text-success': transaccionSeleccionada.Monto > 0, 'text-danger': transaccionSeleccionada.Monto < 0}">
                        {{ isValidMonto(transaccionSeleccionada.Monto) }}
                      </td>
                    </tr>
                    <tr>
                      <th>Estado:</th>
                      <td>
                        <span class="badge" [ngClass]="{
                          'bg-warning': transaccionSeleccionada.Estado === 'Pendiente',
                          'bg-success': transaccionSeleccionada.Estado === 'Aprobado',
                          'bg-danger': transaccionSeleccionada.Estado === 'Cancelado'
                        }">{{ transaccionSeleccionada.Estado }}</span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="col-md-6">
                <h6 class="section-title">Datos del operador</h6>
                <table class="table table-sm modal-table">
                  <tbody>
                    <tr>
                      <th>RFC:</th>
                      <td>{{ transaccionSeleccionada.RFCOperador || 'N/A' }}</td>
                    </tr>
                    <tr>
                      <th>Nombre completo:</th>
                      <td>{{ transaccionSeleccionada.NombreCompletoOperador || 'N/A' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            
            <div class="row mt-4">
              <div class="col-md-6">
                <h6 class="section-title">Datos del beneficiario</h6>
                <table class="table table-sm modal-table">
                  <tbody>
                    <tr>
                      <th>Nombre:</th>
                      <td>{{ transaccionSeleccionada.NombreCompletoBeneficiario || 'N/A' }}</td>
                    </tr>
                    <tr>
                      <th>Número de cuenta:</th>
                      <td>{{ transaccionSeleccionada.NumeroCuentaBeneficiario || 'N/A' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="col-md-6">
                <h6 class="section-title">Datos del ordenante</h6>
                <table class="table table-sm modal-table">
                  <tbody>
                    <tr>
                      <th>Nombre:</th>
                      <td>{{ transaccionSeleccionada.NombreCompletoOrdenante || 'N/A' }}</td>
                    </tr>
                    <tr>
                      <th>Número de cuenta:</th>
                      <td>{{ transaccionSeleccionada.NumeroCuentaOrdenante || 'N/A' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="cerrarModal()">Cerrar</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
</body>
</html>